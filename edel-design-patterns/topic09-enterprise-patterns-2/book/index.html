 <!DOCTYPE html>
 <html>
   <head>

     <link href='https://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>

     <meta charset="utf-8">
     <meta name="viewport" content="width=device-width, initial-scale=1">

     <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.4/semantic.min.css" type="text/css">
     <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.7.0/styles/solarized-light.min.css" rel="stylesheet" />

     <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
     <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery.address/1.6/jquery.address.min.js"></script>
     <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.4/semantic.min.js"></script>
     <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.7.0/highlight.min.js"></script>
     <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.7.0/languages/java.min.js"></script>
     <script>hljs.initHighlightingOnLoad();</script>

      <style>
        

body 
{
  font-family: "Open Sans", "Helvetica", "Helvetica Neue",  "Arial", sans-serif;
}

figcaption
{
  margin-bottom: 20px;
}

.vertical-align
{
  display: flex;
  align-items: center;
}



    </style>

  </head>

  <body>
    

<style>
  

code
{
  font-family: "Monaco";
  font-size: 110%;
}

img
{
  padding:1px;
  border:1px solid black;
}

h1
{
  font-style:italic;
  font-size:130%;
  border-bottom: thin solid black;
}
h2
{
  font-size:110%;
  border-bottom: thin solid black;
}
h3
{
  font-size:100%;
  border-bottom: thin solid black;
}



</style>

<div class="ui fixed top pointing inverted menu labmenu">
  <header class="header item">
    <i id="toc" class="sitemap icon"></i>
    <a href="../index.html">
      Enterprise Patterns II
    </a>
  </header>
  <div class="right tab-menu menu">
    
    <a class="item" data-tab="Lab-09">
      Lab-09
    </a>
    
    <a class="item" data-tab="01">
      01
    </a>
    
    <a class="item" data-tab="02">
      02
    </a>
    
    <a class="item" data-tab="03">
      03
    </a>
    
    <a class="item" data-tab="04">
      04
    </a>
    
    <a class="item" data-tab="05">
      05
    </a>
    
    <a class="item" data-tab="06">
      06
    </a>
    
    <a class="item" data-tab="07">
      07
    </a>
    
    <a class="item" data-tab="08">
      08
    </a>
    
    <a class="item" data-tab="Exercises">
      Exercises
    </a>
    
    <a class="item" href="../../index.html">
      <i class="home icon"></i>
    </a>
  </div>
</div>

<div class="ui segment pushable">
  <div class="ui inverted labeled icon left inline vertical sidebar menu">
    
      
        <a class="item" href="../../topic01-context/book/index.html">
          Lab-01
        </a>
      
    
      
        <a class="item" href="../../topic02-template-method-strategy/book-template-method-strategy/index.html">
          Lab-02
        </a>
      
    
      
        <a class="item" href="../../topic03-command/book-a-command/index.html">
          Lab-03
        </a>
      
    
      
        <a class="item" href="../../topic04-prototype/book-a-prototype/index.html">
          lab-04
        </a>
      
    
      
        <a class="item" href="../../topic05-gof-patterns/book/index.html">
          Lab-05
        </a>
      
    
      
        <a class="item" href="../../topic06-adapter-singleton-memento/book/index.html">
          Lab-06
        </a>
      
    
      
        <a class="item" href="../../topic07-enterprise-patterns-1/book/index.html">
          Lab-07
        </a>
      
    
      
        <a class="item" href="../../topic08-architecture/book/index.html">
          Lab-08
        </a>
      
    
      
        <a class="active item" href="../../topic09-enterprise-patterns-2/book/index.html">
          Lab-09
        </a>
      
    
      
        <a class="item" href="../../topic10-half-sync/book/index.html">
          Lab-10
        </a>
      
    
      
        <a class="item" href="../../topic11-microservices/book-a/index.html">
          Lab-11-A
        </a>
      
    
      
        <a class="item" href="../../topic11-microservices/book-b/index.html">
          Lab-11-B
        </a>
      
    
      
        <a class="item" href="../../topic12-xtend/book-a/index.html">
          Lab-12-A
        </a>
      
    
      
        <a class="item" href="../../topic12-xtend/book-b/index.html">
          Lab-12-B
        </a>
      
    
      
        <a class="item" href="../../topic12-xtend/book-c/index.html">
          Lab-12-C
        </a>
      
    
      
        <a class="item" href="../../topic13-swift/book/index.html">
          SwiftToDoLab
        </a>
      
    
  </div>
  <div class="pusher">
    <div class="ui basic segment">
      <br>
      
      <div  class="ui tab segment lab" data-tab="Lab-09">
        <h1>Objectives</h1>
<p>Extend the pacemaker-service application to incorporate service layer. Utilize the layer in the pacemaker-android to retrieve a list of current users</p>

      </div>
     
      <div  class="ui tab segment lab" data-tab="01">
        <h1>Setup</h1>
<p>This is v3 of the pacemaker-android project from the last android lab:</p>
<ul>
<li><a href="./archives/pacemaker-android-v3.zip">pacemaker-android-v3.zip</a></li>
</ul>
<p>You can import this for reference purposes, or keep working with your own version.</p>
<h1>Logout Feature</h1>
<p>Currently the pacemaker-android app does not have an ability for a user to logout. Introduce the following changes to introduce this feature:</p>
<h2>PacemakerApp</h2>
<pre><code class="lang-java">public class PacemakerApp extends Application
{
  ...

  public void logout()
  {
    loggedInUser = null;
  }</code></pre>
<h2>strings.xml</h2>
<pre><code class="lang-xml">    &lt;string name=&quot;action_logout&quot;&gt;Logout&lt;/string&gt;
    &lt;string name=&quot;action_create_activities&quot;&gt;Create Activity&lt;/string&gt;</code></pre>
<h2>menu/activities_create.xml</h2>
<pre><code class="lang-xml">&lt;menu xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot; &gt;

    &lt;item
        android:id=&quot;@+id/action_settings&quot;
        android:orderInCategory=&quot;100&quot;
        android:showAsAction=&quot;never&quot;
        android:title=&quot;@string/action_settings&quot;/&gt;

    &lt;item
        android:id=&quot;@+id/action_list_actvities&quot;
        android:orderInCategory=&quot;100&quot;
        android:showAsAction=&quot;never&quot;
        android:title=&quot;@string/action_list_activities&quot;/&gt;

    &lt;item
        android:id=&quot;@+id/action_logout&quot;
        android:orderInCategory=&quot;100&quot;
        android:showAsAction=&quot;never&quot;
        android:title=&quot;@string/action_logout&quot;/&gt;        

&lt;/menu&gt;</code></pre>
<h2>menu/activities_list.xml</h2>
<pre><code class="lang-xml">&lt;menu xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot; &gt;

    &lt;item
        android:id=&quot;@+id/action_settings&quot;
        android:orderInCategory=&quot;100&quot;
        android:showAsAction=&quot;never&quot;
        android:title=&quot;@string/action_settings&quot;/&gt;

    &lt;item
        android:id=&quot;@+id/action_create_actvities&quot;
        android:orderInCategory=&quot;100&quot;
        android:showAsAction=&quot;never&quot;
        android:title=&quot;@string/action_create_activities&quot;/&gt;

    &lt;item
        android:id=&quot;@+id/action_logout&quot;
        android:orderInCategory=&quot;100&quot;
        android:showAsAction=&quot;never&quot;
        android:title=&quot;@string/action_logout&quot;/&gt;        

&lt;/menu&gt;</code></pre>
<h2>CreateActivity</h2>
<pre><code class="lang-java">  @Override
  public boolean onOptionsItemSelected(MenuItem item)
  {
    switch (item.getItemId())
    {
      case R.id.action_list_actvities : startActivity (new Intent(this, ActivitiesList.class));
                                        break;                            
      case R.id.action_logout         : startActivity (new Intent(this, Welcome.class));
                                        break;     

    }
    return true;
  }</code></pre>
<h2>ActivitiesList</h2>
<pre><code class="lang-java">  @Override
  public boolean onOptionsItemSelected(MenuItem item)
  {
    switch (item.getItemId())
    {
      case R.id.action_create_actvities : startActivity (new Intent(this, CreateActivity.class));
                                          break;                            
      case R.id.action_logout           : startActivity (new Intent(this, Welcome.class));
                                          break;     
    }
    return true;
  }</code></pre>

      </div>
     
      <div  class="ui tab segment lab" data-tab="02">
        <h1>Seperated Activities by User</h1>
<p>Currently a single list of activities is maintained, regardless of which user is logged on. We can easily refactor this by altering the data structure as follows:</p>
<h2>PacemakerApp</h2>
<pre><code class="lang-java">  private Map&lt;String, List&lt;Activity&gt;&gt; activities    = new HashMap&lt;String, List&lt;Activity&gt;&gt;();</code></pre>
<pre><code class="lang-java">  public void registerUser(User user)
  {
    users.put(user.email, user);
    activities.put(user.email, new ArrayList&lt;Activity&gt;());
  }</code></pre>
<pre><code class="lang-java">  public void createActivity (Activity activity)
  {
    if (loggedInUser != null)
    {
      List&lt;Activity&gt; usersActivities = activities.get(loggedInUser.email);
      activities.put(loggedInUser.email, usersActivities);
      usersActivities.add(activity);
    }
  }

  public List&lt;Activity&gt; getActivities()
  {
    List&lt;Activity&gt; usersActivities = null;
    if (loggedInUser != null)
    {
     usersActivities = activities.get(loggedInUser.email);
    }
    return usersActivities;
  }</code></pre>

      </div>
     
      <div  class="ui tab segment lab" data-tab="03">
        <h1>JSON Parser Library</h1>
<p>If we wish to build a service layer into pacemaker-service, then we need an agreed data format for exchanging objects. JSON is the accepted format for the style of interface we are proposing.</p>
<p>We need to extend the pacemaker-service project as follows:</p>
<h2>pacemakerplay Project:</h2>
<h3>build.sbt</h3>
<p>This is the build configuration for the application, which extend to incorporate the json library we have selected:</p>
<pre><code>name := &quot;pacemakerplay&quot;

version := &quot;1.0-SNAPSHOT&quot;

libraryDependencies ++= Seq(
  javaJdbc,
  javaEbean,
  cache,
  &quot;net.sf.flexjson&quot; % &quot;flexjson&quot; % &quot;3.1&quot;
)     

play.Project.playJavaSettings</code></pre>
<p>The project will need to be rebuilt, and the eclipise view regenerated:</p>
<pre><code>play
compile
eclipse</code></pre>
<h2>pacemaker-android</h2>
<p>The Android project will need to use the same library:</p>
<p>Copy:</p>
<ul>
<li><a href="./archives/flexjson-3.1.jar">flexjson-3.1.jar</a></li>
</ul>
<p>to &#39;lib&#39; folder and add to build path.</p>
<h1>JSon Parser Classes</h1>
<p>Both projects can use the same serializers. Place this class in &#39;the models&#39; package in both projects:</p>
<pre><code>import java.util.ArrayList;
import java.util.List;
import flexjson.JSONDeserializer;
import flexjson.JSONSerializer;

public class JsonParser
{
  public static JSONSerializer userSerializer     = new JSONSerializer().exclude(&quot;class&quot;)
                                                                        .exclude(&quot;persistent&quot;)
                                                                        .exclude(&quot;entityId&quot;); 
  public static JSONSerializer activitySerializer = new JSONSerializer().exclude(&quot;class&quot;)
                                                                        .exclude(&quot;persistent&quot;)
                                                                        .exclude(&quot;entityId&quot;); 

  public static User json2User(String json)
  {
    return new JSONDeserializer&lt;User&gt;().deserialize(json, User.class); 
  }

  public static List&lt;User&gt; json2Users(String json)
  {
    return new JSONDeserializer&lt;ArrayList&lt;User&gt;&gt;().use(&quot;values&quot;, User.class)
                                                  .deserialize(json);
  }

  public static String user2Json(Object obj)
  {
    return userSerializer.serialize(obj);
  }

  public static Activity json2Activity(String json)
  {
    Activity activity = new JSONDeserializer&lt;Activity&gt;().deserialize(json,   Activity.class);
    return activity;
  }

  public static String activity2Json(Object obj)
  {
    return activitySerializer.serialize(obj);
  }

  public static  List&lt;Activity&gt; json2Activities (String json)
  {
    return new JSONDeserializer&lt;ArrayList&lt;Activity&gt;&gt;().use(&quot;values&quot;, Activity.class).deserialize(json);
  }   
}</code></pre>

      </div>
     
      <div  class="ui tab segment lab" data-tab="04">
        <h1>pacemakerplay API</h1>
<p>We now define the API proper in pacemaker-service&quot;</p>
<h2>Routes</h2>
<pre><code># API

GET     /api/users                                 controllers.PacemakerAPI.users()
DELETE  /api/users                                 controllers.PacemakerAPI.deleteAllUsers()
POST    /api/users                                 controllers.PacemakerAPI.createUser()

GET    /api/users/:id                              controllers.PacemakerAPI.user(id: Long)
DELETE /api/users/:id                              controllers.PacemakerAPI.deleteUser(id: Long)
PUT    /api/users/:id                              controllers.PacemakerAPI.updateUser(id: Long)

GET     /api/users/:userId/activities              controllers.PacemakerAPI.activities(userId: Long)
POST    /api/users/:userId/activities              controllers.PacemakerAPI.createActivity(userId: Long)

GET     /api/users/:userId/activities/:activityId  controllers.PacemakerAPI.activity(userId: Long, activityId:Long)
DELETE  /api/users/:userId/activities/:activityId  controllers.PacemakerAPI.deleteActivity(userId: Long, activityId:Long)
PUT     /api/users/:userId/activities/:activityId  controllers.PacemakerAPI.updateActivity(userId: Long, activityId:Long)</code></pre>
<h2>PacemakerAPI</h2>
<pre><code class="lang-java">package controllers;

import static models.JsonParser.*;
import java.util.List;
import models.Activity;
import models.User;
import play.mvc.Controller;
import play.mvc.Result;

public class PacemakerAPI extends Controller
{  

  public static Result  users()
  {
    List&lt;User&gt; users = User.findAll();
    return ok(user2Json(users));
  }

  public static Result user(Long id)
  {
    User user = User.findById(id);  
    return user==null? notFound() : ok(user2Json(user)); 
  }

  public static Result createUser()
  {
    User user = json2User(request().body().asJson().toString());
    user.save();
    return ok(user2Json(user));
  }

  public static Result deleteUser(Long id)
  {
    Result result = notFound();
    User user = User.findById(id);
    if (user != null)
    {
      user.delete();
      result = ok();
    }
    return result;
  }

  public static Result deleteAllUsers()
  {
    User.deleteAll();
    return ok();
  }

  public static Result updateUser(Long id)
  {
    Result result = notFound();
    User user = User.findById(id);
    if (user != null)
    {
      User updatedUser = json2User(request().body().asJson().toString());
      user.update(updatedUser);
      user.save();
      result = ok(user2Json(user));
    }
    return result;
  }

  public static Result activities (Long userId)
  {  
    User p = User.findById(userId);
    return ok(activity2Json(p.activities));
  }

  public static Result createActivity (Long userId)
  { 
    User    user      = User.findById(userId);
    Activity activity = json2Activity(request().body().asJson().toString());  

    user.activities.add(activity);
    user.save();

    return ok(activity2Json(activity));
  }

  public static Result activity (Long userId, Long activityId)
  {  
    User    user      = User.findById(userId);
    Activity activity = Activity.findById(activityId);

    if (activity == null)
    {
      return notFound();
    }
    else
    {
      return user.activities.contains(activity)? ok(activity2Json(activity)): badRequest();
    }
  }  

  public static Result deleteActivity (Long userId, Long activityId)
  {  
    User    user      = User.findById(userId);
    Activity activity = Activity.findById(activityId);
    if (activity == null)
    {
      return notFound();
    }
    else
    {
      if (user.activities.contains(activity))
      {
        user.activities.remove(activity);
        activity.delete();
        user.save();
        return ok();
      }
      else
      {
        return badRequest();
      }

    }
  }  

  public static Result updateActivity (Long userId, Long activityId)
  {
    User    user      = User.findById(userId);
    Activity activity = Activity.findById(activityId);
    if (activity == null)
    {
      return notFound();
    }
    else
    {
      if (user.activities.contains(activity))
      {
        Activity updatedActivity = json2Activity(request().body().asJson().toString());
        activity.distance = updatedActivity.distance;
        activity.location = updatedActivity.location;
        activity.kind     = updatedActivity.kind;

        activity.save();
        return ok(activity2Json(updatedActivity));
      }
      else
      {
        return badRequest();
      }
    }
  }  
}</code></pre>

      </div>
     
      <div  class="ui tab segment lab" data-tab="05">
        <h1>Testing pacemakerplay API</h1>
<h1>Testing</h1>
<p>Make sure the app is running, and browse to :</p>
<ul>
<li><a href="http://localhost:9000/api/users">http://localhost:9000/api/users</a></li>
</ul>
<p>Viewing the page source, you should see:</p>
<pre><code>[]</code></pre>
<p>Also, if using chrome, keep an eye on the actual http traffic (via Tools menu -&gt;Developers Tools):</p>
<p><img src="img/00.png" alt=""></p>
<p>Try browsing to this url:</p>
<ul>
<li><a href="http://localhost:9000/api/users/1">http://localhost:9000/api/users/1</a></li>
</ul>
<p>The browser will be blank, however, the developer tools should display the actual response:</p>
<p><img src="img/01.png" alt=""></p>
<p>This reveals a &#39;404&#39; not found error.</p>
<p>More comprehensive tools for testing http interfaces are available. Search for the Chrome &#39;Postman REST Client&#39; - and install as a chrome app on your workstation. Using Postman, experiment with the two links we tested above:</p>
<p><img src="img/02.png" alt=""></p>
<p>Now try to replicate the request as shown below (note the `Headers&#39; Content-Type set to &#39;application/json&#39;:</p>
<p><img src="img/03.png" alt=""></p>
<p>When you press &#39;Send&#39; you may see this response:</p>
<p><img src="img/04.png" alt=""></p>
<p>No try this request again:</p>
<ul>
<li><a href="http://localhost:9000/api/users/1">http://localhost:9000/api/users/1</a></li>
</ul>
<p>In the above interchange, we have use the REST interface to create a User, and then subsequently get the user (by the id 1).</p>
<p>Create a few more users and verify that you can get them. See if you can also do the following:</p>
<ul>
<li>Delete (via a DELETE) request</li>
<li>Update (via a PUT) request.</li>
</ul>
<p>Also, examine the database via the h2-console, and see if you can verify if the &#39;my_users&#39; table is being updated.</p>

      </div>
     
      <div  class="ui tab segment lab" data-tab="06">
        <h1>pacemaker-android HTTP package</h1>
<p>We need new package of classes in the android application to converse with the pacemaker-service app:</p>
<p>Create a new package called &#39;org.pacemaker.http&#39;, and incorporate these classes:</p>
<pre><code class="lang-java">package org.pacemaker.http;

import java.util.List;
import android.app.ProgressDialog;
import android.content.Context;
import android.os.AsyncTask;

@SuppressWarnings(&quot;rawtypes&quot;)
public abstract class Request extends AsyncTask&lt;Object, Void, Object&gt;
{
  public Response         responder;
  public ProgressDialog   dialog;
  public Context          context;
  public String           message;
  public Exception        error;

  public Request(Context context, Response responder, String message)
  {
    this.responder = responder;
    this.context = context;
    this.message = message;
  }

  @Override
  protected void onPreExecute()
  {
    super.onPreExecute();
    this.dialog = new ProgressDialog(context, 1);
    this.dialog.setMessage(message);
    this.dialog.show();
  }

  @Override
  protected  Object doInBackground(Object... params)
  {
    error = null;
    try
    {
      return doRequest(params);
    }
    catch (Exception e)
    {
      error = e;
    }
    return null;
  }

  protected abstract  Object doRequest(Object... params) throws Exception;

  @SuppressWarnings(&quot;unchecked&quot;)
  @Override
  protected void onPostExecute(Object result)
  {
    super.onPostExecute(result);
    if (dialog.isShowing())
    {
      dialog.dismiss();
    }
    if (error != null)
    {
      responder.errorOccurred(error);  
    }
    else
    {
      if (result instanceof List)
      {
        responder.setResponse((List)result);
      }
      else
      {
        responder.setResponse(result);
      }
    }
  } 
}</code></pre>
<pre><code>package org.pacemaker.http;

import java.util.List;

public interface Response&lt;T&gt;
{
  public void setResponse(List&lt;T&gt; aList);
  public void setResponse(T anObject);
  public void errorOccurred (Exception e);
}</code></pre>
<pre><code>package org.pacemaker.http;

import org.apache.http.HttpResponse;
import org.apache.http.client.methods.HttpDelete;
import org.apache.http.client.methods.HttpGet;
import org.apache.http.client.methods.HttpPost;
import org.apache.http.client.methods.HttpPut;
import org.apache.http.entity.StringEntity;
import org.apache.http.impl.client.BasicResponseHandler;
import org.apache.http.impl.client.DefaultHttpClient;
import org.apache.http.params.BasicHttpParams;
import org.apache.http.params.HttpConnectionParams;
import org.apache.http.params.HttpParams;

public class Rest
{
  private static DefaultHttpClient httpClient = null;
  private static final String URL = &quot;http://10.0.2.2:9000&quot;;

  private static DefaultHttpClient httpClient()
  {
    if (httpClient == null)
    {
      HttpParams httpParameters = new BasicHttpParams();
      HttpConnectionParams.setConnectionTimeout(httpParameters, 10000);
      HttpConnectionParams.setSoTimeout(httpParameters, 10000);
      httpClient = new DefaultHttpClient(httpParameters);
    }
    return httpClient;
  }

  public static String get(String path) throws Exception
  {
    HttpGet getRequest = new HttpGet(URL + path);
    getRequest.setHeader(&quot;accept&quot;, &quot;application/json&quot;);
    HttpResponse response = httpClient().execute(getRequest);
    return new BasicResponseHandler().handleResponse(response);
  }

  public static String delete(String path) throws Exception
  {
    HttpDelete deleteRequest = new HttpDelete(URL + path);
    HttpResponse response = httpClient().execute(deleteRequest);
    return new BasicResponseHandler().handleResponse(response);
  }

  public static String put(String path, String json) throws Exception
  {
    HttpPut putRequest = new HttpPut(URL + path);
    putRequest.setHeader(&quot;Content-type&quot;, &quot;application/json&quot;);
    putRequest.setHeader(&quot;accept&quot;, &quot;application/json&quot;);

    StringEntity s = new StringEntity(json);
    s.setContentEncoding(&quot;UTF-8&quot;);
    s.setContentType(&quot;application/json&quot;);
    putRequest.setEntity(s);

    HttpResponse response = httpClient().execute(putRequest);
    return new BasicResponseHandler().handleResponse(response);
  }

  public static String post(String path, String json) throws Exception
  {
    HttpPost putRequest = new HttpPost(URL + path);
    putRequest.setHeader(&quot;Content-type&quot;, &quot;application/json&quot;);
    putRequest.setHeader(&quot;accept&quot;, &quot;application/json&quot;);

    StringEntity s = new StringEntity(json);
    s.setContentEncoding(&quot;UTF-8&quot;);
    s.setContentType(&quot;application/json&quot;);
    putRequest.setEntity(s);

    HttpResponse response = httpClient().execute(putRequest);
    return new BasicResponseHandler().handleResponse(response);
  }
}</code></pre>

      </div>
     
      <div  class="ui tab segment lab" data-tab="07">
        <h1>PacemakerAPI Client</h1>
<p>Create a new class in the &#39;org.pacemaker.main&#39; package to encapsulate API access:</p>
<pre><code class="lang-java">package org.pacemaker.main;

import java.util.List;
import org.pacemaker.http.Request;
import org.pacemaker.http.Response;
import org.pacemaker.http.Rest;
import org.pacemaker.models.JsonParser;
import org.pacemaker.models.User;
import android.content.Context;

public class PacemakerAPI
{
  public static void getUsers(Context context, Response&lt;User&gt; response, String dialogMesssage)
  {
    new GetUsers(context, response, dialogMesssage).execute();
  }

  public static void createUser(Context context, Response&lt;User&gt; response, String dialogMesssage, User user)
  {
    new CreateUser(context, response, dialogMesssage).execute(user);
  }
}

class GetUsers extends Request
{
  public GetUsers(Context context, Response&lt;User&gt; callback, String message)
  {
    super(context, callback, message);
  }

  @Override
  protected List&lt;User&gt; doRequest(Object... params) throws Exception
  {
    String response = Rest.get(&quot;/api/users&quot;);
    List&lt;User&gt; userList = JsonParser.json2Users(response);
    return userList;
  }
}

class CreateUser extends Request
{
  public CreateUser(Context context, Response&lt;User&gt; callback, String message)
  {
    super(context, callback, message);
  }

  @Override
  protected User doRequest(Object... params) throws Exception
  {
    String response = Rest.post(&quot;/api/users&quot;, JsonParser.user2Json(params[0]));
    return JsonParser.json2User(response);
  }
}</code></pre>

      </div>
     
      <div  class="ui tab segment lab" data-tab="08">
        <h1>Connect</h1>
<p>In order to use network access from android, you will need to specifically enable it in the android manifest:</p>
<h2>AndroidManifest.xml</h2>
<pre><code>    &lt;uses-permission android:name=&quot;android.permission.INTERNET&quot;/&gt;</code></pre>
<h2>Welcome Activity</h2>
<p>We can now retrieve the users list from the welcome activity:</p>
<pre><code>  public void onCreate(Bundle savedInstanceState)
  {
    super.onCreate(savedInstanceState);
    setContentView(R.layout.activity_welcome);
    app = (PacemakerApp) getApplication();
    PacemakerAPI.getUsers(this, app, &quot;Retrieving list of users&quot;);
  }</code></pre>
<p>Note that the second paramater in the above - <code>app</code> - must implement the Response interface:</p>
<h2>PacemakerApp</h2>
<pre><code class="lang-java">public class PacemakerApp extends Application implements Response&lt;User&gt;
{
  private Map&lt;String, User&gt;           users         = new HashMap&lt;String, User&gt;();
  private Map&lt;String, List&lt;Activity&gt;&gt; activities    = new HashMap&lt;String, List&lt;Activity&gt;&gt;();
  private User                        loggedInUser;
  private boolean                     connected     = false;

  @Override
  public void setResponse(List&lt;User&gt; aList)
  {
    connected = true;
    for (User user : aList)
    {
      users.put(user.email, user);
    }
  }

  @Override
  public void setResponse(User anObject)
  {
    connected = true;
  }

  @Override
  public void errorOccurred(Exception e)
  {
    connected = false;
    Toast toast = Toast.makeText(this, &quot;Failed to connect to Pacemaker Service&quot;, Toast.LENGTH_SHORT);
    toast.show();
  }</code></pre>

      </div>
     
      <div  class="ui tab segment lab" data-tab="Exercises">
        <h1>Exercises</h1>
<p>Archive of the app so far:</p>
<ul>
<li><a href="./archives/pacemaker-android-v4.zip">pacemaker-android-v4.zip</a></li>
</ul>
<h2>Exercise 1: Users</h2>
<p>Currently PacemakerApp.registerUser creates a local User object, and has no impact on the server. Change this such that, when registering a new user, the user object is created on the server.</p>
<h2>Exercise 2: Activities</h2>
<p>PacemakerApp.getActivities and PacemakerApp.createActivities are still just working with the local copies. Rework these such that they are creating/retreiving activities to/from the pacemakerplay service.</p>

      </div>
     
    </div>
  </div>
</div>
  <div class="ui bottom fixed borderless right menu">
    <div class="ui right tiny menu">
      <div class="ui mini message segment">
        Eamonn de Leastar.
        <a  href="http://creativecommons.org/licenses/by-nc/4.0/" title="External link to http://creativecommons.org/licenses/by-nc/4.0/"
            target="_blank">Creative Commons License
        </a>
      </div>
    </div>
  </div>

    <footer>

    </footer>
    <script>
      
$(document).ready(function()
{
  $("img").addClass ("ui image");
  $('.ui.embed').embed();

  var images = $(".lab img");
  jQuery.each(images, function(i)  {
    if((images[i].alt).length > 0)
    {
      var div_img = $(document.createElement("div")).addClass("ui segment");
      $(images[i]).wrap(div_img);
      var div_label = $(document.createElement("div")).addClass("ui ribbon teal top attached label");
      div_label.append(images[i].alt);
      $(div_label).insertBefore(images[i]);
    }
  });


  $('.ui.menu .item')
      .tab({
        history: true,
        historyType: 'hash',
      });

  $('.popup').popup();

  $('.ui.sidebar')
      .sidebar({ context: $('.pushable') })
      .sidebar('setting', 'transition', 'slide out')
      .sidebar('attach events', '#toc');
});

    </script>
  </body>

 </html>