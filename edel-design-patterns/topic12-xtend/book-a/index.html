 <!DOCTYPE html>
 <html>
   <head>

     <link href='https://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>

     <meta charset="utf-8">
     <meta name="viewport" content="width=device-width, initial-scale=1">

     <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.4/semantic.min.css" type="text/css">
     <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.7.0/styles/solarized-light.min.css" rel="stylesheet" />

     <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
     <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery.address/1.6/jquery.address.min.js"></script>
     <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.4/semantic.min.js"></script>
     <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.7.0/highlight.min.js"></script>
     <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.7.0/languages/java.min.js"></script>
     <script>hljs.initHighlightingOnLoad();</script>

      <style>
        

body 
{
  font-family: "Open Sans", "Helvetica", "Helvetica Neue",  "Arial", sans-serif;
}

figcaption
{
  margin-bottom: 20px;
}

.vertical-align
{
  display: flex;
  align-items: center;
}



    </style>

  </head>

  <body>
    

<style>
  

code
{
  font-family: "Monaco";
  font-size: 110%;
}

img
{
  padding:1px;
  border:1px solid black;
}

h1
{
  font-style:italic;
  font-size:130%;
  border-bottom: thin solid black;
}
h2
{
  font-size:110%;
  border-bottom: thin solid black;
}
h3
{
  font-size:100%;
  border-bottom: thin solid black;
}



</style>

<div class="ui fixed top pointing inverted menu labmenu">
  <header class="header item">
    <i id="toc" class="sitemap icon"></i>
    <a href="../index.html">
      Xtend Android
    </a>
  </header>
  <div class="right tab-menu menu">
    
    <a class="item" data-tab="Lab-12-A">
      Lab-12-A
    </a>
    
    <a class="item" data-tab="01">
      01
    </a>
    
    <a class="item" data-tab="02">
      02
    </a>
    
    <a class="item" data-tab="03">
      03
    </a>
    
    <a class="item" data-tab="04">
      04
    </a>
    
    <a class="item" data-tab="05">
      05
    </a>
    
    <a class="item" data-tab="06">
      06
    </a>
    
    <a class="item" data-tab="07">
      07
    </a>
    
    <a class="item" href="../../index.html">
      <i class="home icon"></i>
    </a>
  </div>
</div>

<div class="ui segment pushable">
  <div class="ui inverted labeled icon left inline vertical sidebar menu">
    
      
        <a class="item" href="../../topic01-context/book/index.html">
          Lab-01
        </a>
      
    
      
        <a class="item" href="../../topic02-template-method-strategy/book-template-method-strategy/index.html">
          Lab-02
        </a>
      
    
      
        <a class="item" href="../../topic03-command/book-a-command/index.html">
          Lab-03
        </a>
      
    
      
        <a class="item" href="../../topic04-prototype/book-a-prototype/index.html">
          lab-04
        </a>
      
    
      
        <a class="item" href="../../topic05-gof-patterns/book/index.html">
          Lab-05
        </a>
      
    
      
        <a class="item" href="../../topic06-adapter-singleton-memento/book/index.html">
          Lab-06
        </a>
      
    
      
        <a class="item" href="../../topic07-enterprise-patterns-1/book/index.html">
          Lab-07
        </a>
      
    
      
        <a class="item" href="../../topic08-architecture/book/index.html">
          Lab-08
        </a>
      
    
      
        <a class="item" href="../../topic09-enterprise-patterns-2/book/index.html">
          Lab-09
        </a>
      
    
      
        <a class="item" href="../../topic10-half-sync/book/index.html">
          Lab-10
        </a>
      
    
      
        <a class="item" href="../../topic11-microservices/book-a/index.html">
          Lab-11-A
        </a>
      
    
      
        <a class="item" href="../../topic11-microservices/book-b/index.html">
          Lab-11-B
        </a>
      
    
      
        <a class="active item" href="../../topic12-xtend/book-a/index.html">
          Lab-12-A
        </a>
      
    
      
        <a class="item" href="../../topic12-xtend/book-b/index.html">
          Lab-12-B
        </a>
      
    
      
        <a class="item" href="../../topic12-xtend/book-c/index.html">
          Lab-12-C
        </a>
      
    
      
        <a class="item" href="../../topic13-swift/book/index.html">
          SwiftToDoLab
        </a>
      
    
  </div>
  <div class="pusher">
    <div class="ui basic segment">
      <br>
      
      <div  class="ui tab segment lab" data-tab="Lab-12-A">
        <h1>Objectives</h1>
<p>Develop an application in Android using the Xtend language</p>

      </div>
     
      <div  class="ui tab segment lab" data-tab="01">
        <h1>Install XTend &amp; Android SDK</h1>
<p>Download latest Android SDK Bundle:</p>
<ul>
<li><a href="http://developer.android.com/sdk">http://developer.android.com/sdk</a></li>
</ul>
<p>Download the full eclipse with xtend distro from here:</p>
<ul>
<li><a href="https://www.eclipse.org/xtend/download.html">https://www.eclipse.org/xtend/download.html</a></li>
</ul>
<p>Using the xtend version of eclipse, install the android SDK into it using this update site:</p>
<ul>
<li><a href="http://developer.android.com/sdk/installing/installing-adt.html">http://developer.android.com/sdk/installing/installing-adt.html</a></li>
</ul>

      </div>
     
      <div  class="ui tab segment lab" data-tab="02">
        <h1>Starter Application</h1>
<p>Create a standard Android Application called &#39;yambax&#39;, with the following characteristics:</p>
<p><img src="img/00.png" alt="">
<img src="img/00b.png" alt="">
<img src="img/00c.png" alt=""></p>
<p>Make sure you can launch this application in the emulator</p>
<p><img src="img/06.png" alt=""></p>
<p>Bring in these string reources:</p>
<h2>res/values/strings.xml</h2>
<pre><code>&lt;resources&gt;
  &lt;string name=&quot;app_name&quot;&gt;Yamba X&lt;/string&gt;
  &lt;string name=&quot;titleYamba&quot;&gt;YambaX&lt;/string&gt;
  &lt;string name=&quot;titleStatus&quot;&gt;Status Update&lt;/string&gt;
  &lt;string name=&quot;hintText&quot;&gt;Please enter your 140-character status&lt;/string&gt;
  &lt;string name=&quot;buttonUpdate&quot;&gt;Update&lt;/string&gt;
&lt;/resources&gt;</code></pre>
<p>... and this layout:</p>
<h2>res/layout/activity_status.xml</h2>
<pre><code>&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
  android:orientation=&quot;vertical&quot; android:layout_width=&quot;fill_parent&quot;
  android:layout_height=&quot;fill_parent&quot;&gt;

  &lt;!-- Title TextView--&gt;
  &lt;TextView android:layout_width=&quot;fill_parent&quot;
    android:layout_height=&quot;wrap_content&quot; android:gravity=&quot;center&quot;
    android:textSize=&quot;30sp&quot;
    android:layout_margin=&quot;10dp&quot; android:text=&quot;@string/titleStatus&quot;/&gt;

  &lt;!-- Status EditText  --&gt;
  &lt;EditText android:layout_width=&quot;fill_parent&quot;
    android:layout_height=&quot;0dp&quot; android:layout_weight=&quot;1&quot;
    android:hint=&quot;@string/hintText&quot; android:id=&quot;@+id/editText&quot;
    android:gravity=&quot;top|center_horizontal&quot;&gt;&lt;/EditText&gt;

  &lt;!-- Update Button --&gt;
  &lt;Button android:layout_width=&quot;fill_parent&quot;
    android:layout_height=&quot;wrap_content&quot; android:text=&quot;@string/buttonUpdate&quot;
    android:textSize=&quot;20sp&quot; android:id=&quot;@+id/buttonUpdate&quot;&gt;&lt;/Button&gt;

&lt;/LinearLayout&gt;</code></pre>
<p>Download this jar archive :</p>
<ul>
<li><a href="archives/jtwitter-yamba.jar">jtwitter-yamba.jar</a></li>
</ul>
<p>and copy to the  <code>lib</code> folder of your android project.</p>
<p>This is a lightweight java-twitter library, based on this project here:</p>
<ul>
<li><a href="https://github.com/winterstein/JTwitter">https://github.com/winterstein/JTwitter</a></li>
</ul>
<p>Replace your StatusActivity with the following:</p>
<h2>StatusActivity:</h2>
<pre><code class="lang-java">package com.marakana.yambax;

import winterwell.jtwitter.Twitter;
import android.app.Activity;
import android.os.Bundle;
import android.util.Log;
import android.view.View;
import android.view.View.OnClickListener;
import android.widget.Button;
import android.widget.EditText;

public class StatusActivity extends Activity implements OnClickListener
{ 
  private static final String TAG = &quot;StatusActivity&quot;;
  EditText editText;
  Button updateButton;
  Twitter twitter;

  @Override
  public void onCreate(Bundle savedInstanceState)
  {
    super.onCreate(savedInstanceState);
    setContentView(R.layout.activity_status);

    editText = (EditText) findViewById(R.id.editText);
    updateButton = (Button) findViewById(R.id.buttonUpdate);

    updateButton.setOnClickListener(this); 

    twitter = new Twitter(&quot;student&quot;, &quot;password&quot;); 
    twitter.setAPIRootUrl(&quot;http://yamba.marakana.com/api&quot;);
  }

  public void onClick(View v)
  {
    twitter.setStatus(editText.getText().toString()); 
    Log.d(TAG, &quot;onClicked&quot;);
  }
}</code></pre>
<p>Launch and you should see:</p>
<p><img src="img/02.png" alt=""></p>
<p>If you attempt a status update, your application may close. This is caused by an attempt to perform network access on the main thread (inside the twitter.setStatus method). For test purposes, we can disable this:</p>
<pre><code class="lang-java">    StrictMode.ThreadPolicy policy = new StrictMode.ThreadPolicy.Builder().permitAll().build();
    StrictMode.setThreadPolicy(policy);</code></pre>
<p>Run the app again and attempt to update status again. The status should appear here:</p>
<ul>
<li><a href="http://yamba.marakana.com">http://yamba.marakana.com</a></li>
</ul>
<hr>
<h4><a href="https://github.com/edeleastar/yambax/commit/2598f03c03cc3102d743d7a68ab9c987a23dc5c7">source</a></h4>
<hr>

      </div>
     
      <div  class="ui tab segment lab" data-tab="03">
        <h1>Xtext Nature</h1>
<p>Add xtext nature to the project by selecting Project Properties-&gt;Configure-&gt;Add Xtext Nature</p>
<p>Then in settings change the generated java folder to align with ADKs expectations (gen):</p>
<p><img src="img/03.png" alt=""></p>
<p>To prime the project with the correct libraries, create a new XTend class call <code>Test</code> in the <code>com.marakana.yambax</code> package:</p>
<pre><code>package com.marakana.yambax

class Test {

}</code></pre>
<p>This will have an error on the package declaration. Select the error and it will prompt with &quot;Add Xtext Lbraries to the project&quot;. Select this, and the libraries will be added. Your project will look like this:</p>
<p><img src="img/04.png" alt=""></p>
<p>Look carefully at the three jar files added under &#39;Xtend Library&#39;. You will need to locate these files using explorer/finder, and copy them to the <code>lib</code> folder of your project.</p>
<p>Delete the &quot;Xtext Library&quot; artifact from the project by selecting it and then selecting &#39;remove from build path&#39;.</p>
<p>The project should resemble the following:</p>
<p><img src="img/05.png" alt=""></p>
<p>Finally, delete the current classes in com.marakana.com and replace them with the following:</p>
<h2>StatusActivity.xtend</h2>
<pre><code class="lang-java">package com.marakana.yambax

import android.app.Activity
import android.os.Bundle
import android.widget.EditText
import android.widget.Button
import android.view.View.OnClickListener
import android.view.View
import winterwell.jtwitter.Twitter
import android.util.Log
import android.os.StrictMode

class StatusActivity extends Activity implements OnClickListener
{
  val TAG = &quot;StatusActivity&quot;
  var EditText editText
  var Button updateButton
  var twitter = new Twitter(&quot;student&quot;, &quot;password&quot;)

  override onCreate(Bundle savedInstanceState)
  {
    super.onCreate(savedInstanceState)
    setContentView(R.layout.activity_status)

    val policy = new StrictMode.ThreadPolicy.Builder().permitAll().build();
    StrictMode.setThreadPolicy(policy);

    editText     = findViewById(R.id.editText) as EditText
    updateButton =  findViewById(R.id.buttonUpdate) as Button

    updateButton.setOnClickListener(this)

    twitter.setAPIRootUrl(&quot;http://yamba.marakana.com/api&quot;)
  }

  override onClick(View arg0)
  {
      twitter.setStatus(editText.getText.toString)
    Log.d(TAG, &quot;onClicked&quot;)
  }
}</code></pre>
<p>Make sure the application has Internet Permissions enabled in the manifest:</p>
<h2>AndridManifest.xml</h2>
<pre><code>    &lt;uses-permission android:name=&quot;android.permission.INTERNET&quot; /&gt;</code></pre>
<p>You should be able to launch this application on the emulator, enter some text and press &#39;Update&#39;. Expect to see your text on this site:</p>
<ul>
<li><a href="http://yamba.marakana.com">http://yamba.marakana.com</a></li>
</ul>
<hr>
<h4><a href="https://github.com/edeleastar/yambax/commit/7bc6b7b67d0dbe3930bee74bc27b87231335d7d0">Source</a></h4>
<hr>

      </div>
     
      <div  class="ui tab segment lab" data-tab="04">
        <h1>Async Task</h1>
<p>Create a new package <code>com.marakana.utils</code> containing an xtend class to encapsulate the twitter API:</p>
<h2>TwitterAPI.xtend</h2>
<pre><code class="lang-java">package com.marakana.utils

import winterwell.jtwitter.Twitter

class TwitterAPI
{
  var Twitter twitter

  new ()
  {
    this.twitter = new Twitter(&quot;student&quot;, &quot;password&quot;)
    twitter.setAPIRootUrl(&quot;http://yamba.marakana.com/api&quot;)
  }

  def String updateStatus (String status)
  { 
    val result = twitter.updateStatus(status)
    result.text
  }
}</code></pre>
<p>Introduce an AsyncTask <code>com.marakana.utils</code> to use this API:</p>
<h2>TwitterPoster.xtend</h2>
<pre><code class="lang-java">package com.marakana.yambax

import android.os.AsyncTask
import android.util.Log
import winterwell.jtwitter.TwitterException
import android.widget.Toast
import android.app.Activity
import com.marakana.utils.TwitterAPI

class TwitterPoster extends AsyncTask&lt;String, Integer, String&gt;
{
  var TwitterAPI twitter
  var Activity activity

  new(TwitterAPI twitter, Activity activity)
  {
    this.twitter = twitter
    this.activity = activity
  }

  override doInBackground(String... it)
  {
    try
    {
      var status = twitter.updateStatus(get(0))
      status
    }
    catch (TwitterException e)
    {
      Log.e(&quot;YAMBA&quot;, e.toString());
      &quot;Failed to post&quot;;
    }
  }

  override onPostExecute(String result)
  {
    Toast.makeText(activity, result, Toast.LENGTH_LONG).show();
  }
}</code></pre>
<p>Now we can reimplement StatusUpdate activity, using a Lambda to handle the button event:</p>
<pre><code class="lang-java">package com.marakana.yambax

import android.app.Activity
import android.os.Bundle
import android.widget.EditText
import android.widget.Button
import android.util.Log
import com.marakana.utils.TwitterAPI

class StatusActivity extends Activity
{
  val twitter = new TwitterAPI

  override onCreate(Bundle savedInstanceState)
  {
    super.onCreate(savedInstanceState)
    setContentView(R.layout.activity_status)

    val editText     = findViewById(R.id.editText) as EditText
    val updateButton =  findViewById(R.id.buttonUpdate) as Button

    updateButton.setOnClickListener = [ 
                                        val twitterPoster = new TwitterPoster(twitter, this)
                                        twitterPoster.execute(editText.getText().toString())
                                        Log.d(&quot;YAMBA&quot;, &quot;onClicked&quot;) 
                                      ]
  }
}</code></pre>
<p>Notice we no longer need to disable strict mode, as we are not posting from a background task.</p>
<p>Verify this works as expected, and that the status appears on:</p>
<ul>
<li><a href="http://yamba.marakana.com">http://yamba.marakana.com</a></li>
</ul>
<p>A toast message should also appear if the update was successful</p>
<hr>
<h4><a href="https://github.com/edeleastar/yambax/commit/b5d3d142bde4b5e1e73e5ce67f6212b1ff4d059d">Source</a></h4>
<hr>

      </div>
     
      <div  class="ui tab segment lab" data-tab="05">
        <h1>Preferences</h1>
<p>Introduce the following new strings into <code>res/values/strings.xml</code>:</p>
<pre><code>  &lt;string name=&quot;titlePrefs&quot;&gt;Preferences&lt;/string&gt;
  &lt;string name=&quot;titleUsername&quot;&gt;Username&lt;/string&gt;
  &lt;string name=&quot;titlePassword&quot;&gt;Password&lt;/string&gt;
  &lt;string name=&quot;titleApiRoot&quot;&gt;API Root&lt;/string&gt;

  &lt;string name=&quot;summaryUsername&quot;&gt;Please enter your username&lt;/string&gt;
  &lt;string name=&quot;summaryPassword&quot;&gt;Please enter your password&lt;/string&gt;
  &lt;string name=&quot;summaryApiRoot&quot;&gt;URL of Root API for your service&lt;/string&gt;</code></pre>
<p>This will allow us to define a <code>res/menus/menu.xml</code> resource:</p>
<pre><code>&lt;menu xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot; &gt;
    &lt;item android:id=&quot;@+id/itemPrefs&quot; android:title=&quot;@string/titlePrefs&quot;
         android:icon=&quot;@android:drawable/ic_menu_preferences&quot;&gt;&lt;/item&gt;
&lt;/menu&gt;</code></pre>
<p>Now we can create a PreferencesActivity. Introduce a new folder in <code>res</code> called <code>xml</code>, and create this file in there:</p>
<h2>prefs.xml</h2>
<pre><code>&lt;PreferenceScreen xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot; &gt;
  &lt;EditTextPreference android:title=&quot;@string/titleUsername&quot;
    android:summary=&quot;@string/summaryUsername&quot; android:key=&quot;username&quot;&gt;&lt;/EditTextPreference&gt;

  &lt;EditTextPreference android:title=&quot;@string/titlePassword&quot;
    android:password=&quot;true&quot; android:summary=&quot;@string/summaryPassword&quot;
    android:key=&quot;password&quot;&gt;&lt;/EditTextPreference&gt;

  &lt;EditTextPreference android:title=&quot;@string/titleApiRoot&quot;
    android:summary=&quot;@string/summaryApiRoot&quot; android:key=&quot;apiRoot&quot;&gt;&lt;/EditTextPreference&gt;
&lt;/PreferenceScreen&gt;</code></pre>
<p>Create a new <code>PrefsActivity</code> activity class in <code>com.marakana.yambax</code>:</p>
<h2>PrefsActivity.xtend:</h2>
<pre><code class="lang-java">package com.marakana.yambax

import android.os.Bundle
import android.preference.PreferenceActivity;

class PrefsActivity extends PreferenceActivity 
{
  override onCreate(Bundle savedInstanceState)
  {
    super.onCreate(savedInstanceState);
    addPreferencesFromResource(R.xml.prefs); 
  }  
}</code></pre>
<p>We can display a menu and the PrefsActivity in the StatusUdate activity:</p>
<pre><code class="lang-java">  override  onCreateOptionsMenu(Menu menu)
  {
    getMenuInflater.inflate(R.menu.menu, menu)
    true
  }

  override onOptionsItemSelected(MenuItem item)
  {
      startActivity(new Intent(this, typeof(PrefsActivity)))
    true
  }</code></pre>
<p>Finally, make sure the activity is referenced in the manifest:</p>
<pre><code>    &lt;activity android:name=&quot;.PrefsActivity&quot; android:label=&quot;@string/titlePrefs&quot; /&gt;</code></pre>
<p>When the menu is selected, we should see something like this:</p>
<p><img src="img/07.png" alt=""></p>
<hr>
<h4><a href="https://github.com/edeleastar/yambax/commit/6cc742a4372e63c61d34ac47f6e8d75df099e39c">Source</a></h4>
<hr>

      </div>
     
      <div  class="ui tab segment lab" data-tab="06">
        <h1>Lambdas</h1>
<p>Define a new TwitterAPI, which allows account details to be changed:</p>
<h2>TwitterAPI.xtend</h2>
<pre><code class="lang-java">package com.marakana.utils

import winterwell.jtwitter.Twitter
import android.content.SharedPreferences

class TwitterAPI
{
  var Twitter twitter

  new (String username, String password, String root)
  {
    this.twitter = new Twitter(username, password)
    twitter.setAPIRootUrl(root)
  }

  def changeAccount(SharedPreferences prefs)
  {
      val username = prefs.getString(&quot;username&quot;, &quot;student&quot;)
      val password = prefs.getString(&quot;password&quot;, &quot;password&quot;)
      val root     = prefs.getString(&quot;apiRoot&quot;, &quot;http://yamba.marakana.com/api&quot;)
      this.twitter = new Twitter(username, password)
    twitter.setAPIRootUrl(root)
  }

  def String updateStatus (String status)
  { 
    val result = twitter.updateStatus(status)
    result.text
  }
}</code></pre>
<p>This is a revised version of StatusUpdate to use preferences and this new api:</p>
<h2>StatusUpdate.xtend</h2>
<pre><code class="lang-java">package com.marakana.yambax

import android.app.Activity
import android.os.Bundle
import android.widget.EditText
import android.widget.Button
import com.marakana.utils.TwitterAPI
import android.view.Menu
import android.view.MenuItem
import android.content.Intent
import android.view.View.OnClickListener
import android.content.SharedPreferences.OnSharedPreferenceChangeListener
import android.content.SharedPreferences
import android.preference.PreferenceManager

class StatusActivity extends Activity
{
  var EditText       editText
  var Button         updateButton
  var TwitterAPI     twitter 

  var update       = [ new TwitterPoster(twitter, this).execute(editText.getText.toString)  ] as OnClickListener
  var prefsChanged = [ SharedPreferences prefs, String s |
                       twitter.changeAccount(prefs) ]  as OnSharedPreferenceChangeListener

  override onCreate(Bundle savedInstanceState)
  {
    super.onCreate(savedInstanceState)
    setContentView(R.layout.activity_status)

    twitter = new TwitterAPI(&quot;student&quot;, &quot;password&quot;, &quot;http://yamba.marakana.com/api&quot;)

    editText     = findViewById(R.id.editText) as EditText
    updateButton = findViewById(R.id.buttonUpdate) as Button

    updateButton.setOnClickListener = update
    PreferenceManager.getDefaultSharedPreferences(this).registerOnSharedPreferenceChangeListener = prefsChanged        
  }

  override  onCreateOptionsMenu(Menu menu)
  {
    getMenuInflater.inflate(R.menu.menu, menu)
    true
  }

   override onOptionsItemSelected(MenuItem item)
  {
      startActivity(new Intent(this, typeof(PrefsActivity)))
    true
  }
}</code></pre>
<p>Notice the <code>lambdas</code> declared as part of the class definition.</p>
<p>Run the application now. You should be able to tweet as before, but now also be able to use a different account. These accounts can be created on :</p>
<ul>
<li><a href="http://yamba.marakana.com">http://yamba.marakana.com</a></li>
</ul>

      </div>
     
      <div  class="ui tab segment lab" data-tab="07">
        <h1>Application Objects</h1>
<p>Introduce a new Application class, which will manage the preferences settings:</p>
<pre><code class="lang-java">package com.marakana.yambax

import com.marakana.utils.TwitterAPI
import android.content.SharedPreferences
import android.content.SharedPreferences.OnSharedPreferenceChangeListener
import android.app.Application
import android.preference.PreferenceManager

class YambaApplication extends Application
{
  @Property TwitterAPI twitter

  var prefsChanged = [ SharedPreferences prefs, String s|
                       twitter.changeAccount(prefs)  ]  as OnSharedPreferenceChangeListener

  override onCreate()
  {
    super.onCreate
    twitter = new TwitterAPI(&quot;student&quot;, &quot;password&quot;, &quot;http://yamba.marakana.com/api&quot;)
    PreferenceManager.getDefaultSharedPreferences(this).registerOnSharedPreferenceChangeListener = prefsChanged     
  }

  override onTerminate()
  {
    super.onTerminate
  }
}</code></pre>
<p>In this version, we can rework to TwitterPoster to use the TwitterAPI in the ApplicationObject:</p>
<pre><code class="lang-java">package com.marakana.yambax

import android.os.AsyncTask
import android.util.Log
import winterwell.jtwitter.TwitterException
import android.widget.Toast
import android.app.Activity
import com.marakana.utils.TwitterAPI

class TwitterPoster extends AsyncTask&lt;String, Integer, String&gt;
{
  val TwitterAPI twitter
  val Activity activity

  new(Activity activity)
  {
    var app = activity.getApplication() as YambaApplication
    this.twitter = app.twitter
    this.activity = activity
  }

  override doInBackground(String... it)
  {
    try
    {
      var status = twitter.updateStatus(get(0))
      status
    }
    catch (TwitterException e)
    {
      Log.e(&quot;YAMBA&quot;, e.toString());
      &quot;Failed to post&quot;;
    }
  }

  override onPostExecute(String result)
  {
    Toast.makeText(activity, result, Toast.LENGTH_LONG).show();
  }
}</code></pre>
<p>We can now simplify the StatusUpdate class:</p>
<pre><code class="lang-java">package com.marakana.yambax

import android.app.Activity
import android.os.Bundle
import android.widget.EditText
import android.widget.Button
import android.view.Menu
import android.view.MenuItem
import android.content.Intent
import android.view.View.OnClickListener

class StatusActivity extends Activity
{
  var EditText       editText
  var Button         updateButton

  var update       = [ new TwitterPoster(this).execute(editText.getText.toString)  ] as OnClickListener

  override onCreate(Bundle savedInstanceState)
  {
    super.onCreate(savedInstanceState)
    setContentView(R.layout.activity_status)

    editText     = findViewById(R.id.editText) as EditText
    updateButton = findViewById(R.id.buttonUpdate) as Button

    updateButton.setOnClickListener = update   
  }

  override  onCreateOptionsMenu(Menu menu)
  {
    getMenuInflater.inflate(R.menu.menu, menu)
    true
  }

  override onOptionsItemSelected(MenuItem item)
  {
      startActivity(new Intent(this, typeof(PrefsActivity)))
    true
  }
}</code></pre>
<p>We define the ApplicationObject in the manifest:</p>
<pre><code>    &lt;application
        android:allowBackup=&quot;true&quot;
        android:icon=&quot;@drawable/ic_launcher&quot;
        android:label=&quot;@string/app_name&quot;
        android:theme=&quot;@style/AppTheme&quot; 
        android:name=&quot;com.marakana.yambax.YambaApplication&quot;&gt;</code></pre>
<p>Run the application now and it should work as before.</p>
<hr>
<h4><a href="https://github.com/edeleastar/yambax/commit/e65748e11219b9e4887ad781b5c21e9e1be41cc4">Source</a></h4>
<hr>

      </div>
     
    </div>
  </div>
</div>
  <div class="ui bottom fixed borderless right menu">
    <div class="ui right tiny menu">
      <div class="ui mini message segment">
        Eamonn de Leastar.
        <a  href="http://creativecommons.org/licenses/by-nc/4.0/" title="External link to http://creativecommons.org/licenses/by-nc/4.0/"
            target="_blank">Creative Commons License
        </a>
      </div>
    </div>
  </div>

    <footer>

    </footer>
    <script>
      
$(document).ready(function()
{
  $("img").addClass ("ui image");
  $('.ui.embed').embed();

  var images = $(".lab img");
  jQuery.each(images, function(i)  {
    if((images[i].alt).length > 0)
    {
      var div_img = $(document.createElement("div")).addClass("ui segment");
      $(images[i]).wrap(div_img);
      var div_label = $(document.createElement("div")).addClass("ui ribbon teal top attached label");
      div_label.append(images[i].alt);
      $(div_label).insertBefore(images[i]);
    }
  });


  $('.ui.menu .item')
      .tab({
        history: true,
        historyType: 'hash',
      });

  $('.popup').popup();

  $('.ui.sidebar')
      .sidebar({ context: $('.pushable') })
      .sidebar('setting', 'transition', 'slide out')
      .sidebar('attach events', '#toc');
});

    </script>
  </body>

 </html>